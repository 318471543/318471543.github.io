<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="算法模板, 重生带我走">
    <meta name="description" content="
本篇章承载的内容如下：

非模板题不收；
主要收代码量比较大 &amp;#x2F; 容易遗忘的模板好题（不一定是模板题，但做一遍可能就会让你理解这个算法的用处）；
主要收含封装模板的题；

最后感觉，做这个很类似于在整理每个模板，不过去掉了很多相">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>算法模板 | 重生带我走</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">重生带我走</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">重生带我走</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/4.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">算法模板</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/">
                                <span class="chip bg-color">算法模板</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-10-08
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>本篇章承载的内容如下：</p>
<ul>
<li>非模板题不收；</li>
<li>主要收代码量比较大 &#x2F; 容易遗忘的模板好题（不一定是模板题，但做一遍可能就会让你理解这个算法的用处）；</li>
<li>主要收含封装模板的题；</li>
</ul>
<p>最后感觉，做这个很类似于在整理每个模板，不过去掉了很多相关模板的解释，然后每道题只精确了一个例题，也算是帮助会议，便于打印板子。</p>
</blockquote>
<h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><h3 id="数位DP"><a href="#数位DP" class="headerlink" title="数位DP"></a>数位DP</h3><blockquote>
<p>数位 DP 问题一般给定一个区间 $[L,R]$，问区间满足的条件的数有多少个？</p>
<p>可以利用前缀和来求解答案：$∑_{i&#x3D;1}^Rans_i−∑_{i&#x3D;1}^{L−1}ans_i$。</p>
<p><strong>简要描述该模板：</strong></p>
<p><mark>$dp$ 函数：</mark></p>
<ul>
<li>每次初始化 $f$ 数组为 $-1$，$a_i$：每个数位上的具体数字。</li>
</ul>
<p><mark>$dfs$ 函数：</mark></p>
<ul>
<li>参数：</li>
<li>$pos$（必填）：表示当前处理的数的位置（从高位到低位递归）；</li>
<li>未知参数（如 $pre$（上一个数是多少）, $sum$（当前数字之和）等等）：按情况选择；</li>
<li>$lead$（选填）：前导零是否存在，lead &#x3D; 1表示存在前导零，否则不存在；</li>
<li>$limit$（必填）：可以填数的限制（无限制的话（即 $limit &#x3D; 0$） $0$ ~ $9$ 随便填，否则只能填到 $a_{pos}$）。</li>
<li>内部逻辑：</li>
<li>递归结束条件（即 $!pos$）：一般能递归到这里表示合法，通常返回 $1$，或者自定义的答案；</li>
<li>如果无限制且不含前导零且已经处理出答案：返回记忆化的结果；</li>
<li>定义当前能枚举的数的最高位：<ul>
<li>跳过不合法的情况；</li>
<li>$lead$ 的下个位置（固定写法）：$lead\ &amp;&amp;\ !i$ ；</li>
<li>$limit$ 的下个位置（固定写法）：$limit\ &amp;&amp;\ i &#x3D;&#x3D; up$；</li>
</ul>
</li>
<li>返回结果（固定写法）：$return\ limit\ ||\ lead\ ?\ res : dp[pos][sum] &#x3D; res;$</li>
</ul>
</blockquote>
<p><mark>模板（伪代码）：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">int dfs(int pos, int pre, int lead, int limit) &#123;
    if (!pos) &#123;
        边界条件
    &#125;
    if (!limit &amp;&amp; !lead &amp;&amp; f[pos][pre] !&#x3D; -1) return f[pos][pre];
    int res &#x3D; 0, up &#x3D; limit ? a[pos] : 无限制位;
    for (int i &#x3D; 0; i &lt;&#x3D; up; i ++) &#123;
        if (不合法条件) continue;
        res +&#x3D; dfs(pos - 1, 未定参数, lead &amp;&amp; !i, limit &amp;&amp; i &#x3D;&#x3D; up);
    &#125;
    return limit || lead ? res : dp[pos][sum] &#x3D; res;
&#125;
int dp(int x) &#123;
    memset(f, -1, sizeof f);
    int len &#x3D; 0;
    while (x) a[++ len] &#x3D; x % 进制, x &#x2F;&#x3D; 进制;
    return dfs(len, 未定参数, 1, 1);
&#125;
int main() &#123;
    cin &gt;&gt; l &gt;&gt; r;
    cout &lt;&lt; dp(r) - dp(l - 1) &lt;&lt; endl;
&#125;</code></pre>

<p><strong>学习参考：</strong><a target="_blank" rel="noopener" href="https://www.acwing.com/blog/content/7944/">数位DP(DFS做法)</a></p>
<p><strong>推荐题目：</strong><a target="_blank" rel="noopener" href="https://www.acwing.com/problem/content/340/">计数问题</a></p>
<p><mark>代码：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

const int N &#x3D; 15;
int a[N], f[N][N];

&#x2F;&#x2F; dp[pos][sum]: 最后pos位是000 ~999（均pos个），pos前面有sum个num的个数。
int dfs(int pos, int sum, int num, int lead, int limit)
&#123;
    if (!pos)	return sum;
    if (!lead &amp;&amp; !limit &amp;&amp; f[pos][sum] !&#x3D; -1)   return f[pos][sum];

    int res &#x3D; 0, up &#x3D; limit ? a[pos] : 9;
    for (int i &#x3D; 0; i &lt;&#x3D; up; i++)
    &#123;
        int t &#x3D; 0;
        if (i &#x3D;&#x3D; num)
        &#123;
            if (!num)   t &#x3D; sum + !lead;
            else    t &#x3D; sum + 1;
        &#125;
        else    t &#x3D; sum;
        
        res +&#x3D; dfs(pos - 1, t, num, lead &amp;&amp; !i, limit &amp;&amp; i &#x3D;&#x3D; up);
    &#125;
    
    return lead || limit ? res : f[pos][sum] &#x3D; res;
&#125;

int dp(int x, int num)
&#123;
    int len &#x3D; 0;
    memset(f, -1, sizeof (f));
    while (x)
    &#123;
        a[++len] &#x3D; x % 10;
        x &#x2F;&#x3D; 10;
    &#125;
    return dfs(len, 0, num, 1, 1);
&#125;

int main()
&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);

    int l, r;
    while (cin &gt;&gt; l &gt;&gt; r, l || r)
    &#123;
        if (l &gt; r)  swap(l, r);
        for (int i &#x3D; 0; i &lt;&#x3D; 9; i++)
            cout &lt;&lt; dp(r, i) - dp(l - 1, i) &lt;&lt; &quot; \n&quot;[i &#x3D;&#x3D; 9];
    &#125;
    
    return 0;
&#125;</code></pre>



<h2 id="数论"><a href="#数论" class="headerlink" title="数论"></a>数论</h2><h3 id="质因数分解"><a href="#质因数分解" class="headerlink" title="质因数分解"></a>质因数分解</h3><h4 id="获取每个数的最大质因数"><a href="#获取每个数的最大质因数" class="headerlink" title="获取每个数的最大质因数"></a>获取每个数的最大质因数</h4><blockquote>
<p><strong>时间复杂度：</strong>$O(nlogn)$</p>
<p><strong>方法：</strong>埃氏筛</p>
</blockquote>
<p><mark>封装代码：$(show\ by\ jiangly)$</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">std::vector&lt;int&gt; minp, cntp, maxp, primes;
&#x2F;&#x2F; minp: 最小质因数; maxp: 最大质因数; cntp: 质因数个数
void sieve(int n) &#123;
    minp.assign(n + 1, 0);
    maxp.assign(n + 1, 0);
    cntp.assign(n + 1, 0);
    primes.clear();
    
    for (int i &#x3D; 2; i &lt;&#x3D; n; i++) &#123;
        if (minp[i] &#x3D;&#x3D; 0) &#123;
            minp[i] &#x3D; i;
            maxp[i] &#x3D; i;
            cntp[i] &#x3D; 1;
            primes.push_back(i);
        &#125;
        
        for (auto p : primes) &#123;
            if (i * p &gt; n) &#123;
                break;
            &#125;
            minp[i * p] &#x3D; p;
            maxp[i * p] &#x3D; maxp[i];
            cntp[i * p] &#x3D; cntp[i] + 1;
            if (p &#x3D;&#x3D; minp[i]) &#123;
                break;
            &#125;
        &#125;
    &#125;
&#125;</code></pre>

<p><mark>简单代码（容易理解版）：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">const int N &#x3D; 2e6 + 10;
int f[N];&#x2F;&#x2F; f:每个数的最大质因数是多少
void init()
&#123;
	for (int i &#x3D; 2; i &lt;&#x3D; 2e6; i++) 
	&#123;
		if (!f[i]) 
		&#123;
			f[i] &#x3D; i;
			for (int j &#x3D; 2 * i; j &lt;&#x3D; 2e6; j +&#x3D; i)	f[j] &#x3D; i;
		&#125;
	&#125;
&#125;</code></pre>

<p><strong>推荐题目（$tag$：埃氏筛求最大质因数 + RMQ）：</strong><a target="_blank" rel="noopener" href="https://codeforces.com/gym/104493/problem/B">B. Convarge To 1</a></p>
<p><mark>代码：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

typedef long long ll;
typedef pair&lt;int, int&gt; pii;

const int N &#x3D; 2e6 + 10;
int f[N];&#x2F;&#x2F; f:每个数的最大质因数是多少

void init()
&#123;
	for (int i &#x3D; 2; i &lt;&#x3D; 2e6; i++) 
	&#123;
		if (!f[i]) 
		&#123;
			f[i] &#x3D; i;
			for (int j &#x3D; 2 * i; j &lt;&#x3D; 2e6; j +&#x3D; i)	f[j] &#x3D; i;
		&#125;
	&#125;
&#125;

void solve()
&#123;
	int n, q;
	cin &gt;&gt; n &gt;&gt; q;

	vector&lt;int&gt; a(n + 1);
	vector&lt;int&gt; time(n + 1);
	vector&lt;vector&lt;int&gt;&gt; nums(2e6 + 10);
	for (int i &#x3D; 1; i &lt;&#x3D; n; i++)	
	&#123;
		cin &gt;&gt; a[i];
		if (a[i] !&#x3D; 1)
			nums[a[i]].push_back(i);
	&#125;
	
	int timestamps &#x3D; 0;
	for (int i &#x3D; 2e6; i &gt;&#x3D; 2; i--)
	&#123;
		if (!nums[i].size())	continue;

		int nt &#x3D; i &#x2F; f[i];
		if (nt &#x3D;&#x3D; 1) &#x2F;&#x2F; 质数
		&#123;
			sort(nums[i].begin(), nums[i].end());
			for (int j &#x3D; 0; j &lt; nums[i].size(); j++)
			&#123;
				timestamps++;
				time[nums[i][j]] &#x3D; timestamps;
			&#125;
		&#125;
		else
		&#123;
			timestamps +&#x3D; nums[i].size();
			for (auto x : nums[i])
				nums[nt].push_back(x);
		&#125;
	&#125;

	vector&lt;vector&lt;int&gt;&gt; f(n + 1, vector&lt;int&gt;(22));
	vector&lt;int&gt; LG2(n + 1);
	auto _init &#x3D; [&amp;]() -&gt; void
	&#123;
		LG2[1] &#x3D; 0;
		for(int i &#x3D; 2;i &lt;&#x3D; n;i++)   LG2[i]  &#x3D;LG2[i &gt;&gt; 1] + 1;
 
		for(int j &#x3D; 0;j &lt;&#x3D; LG2[n];j++)
			for(int i &#x3D; 1;i + (1 &lt;&lt; j) - 1 &lt;&#x3D; n;i++)
				if(!j)  f[i][j] &#x3D; time[i];
				else    f[i][j] &#x3D; max(f[i][j - 1],f[i + (1 &lt;&lt; j - 1)][j - 1]);  
		return ;
	&#125;;
	auto query &#x3D; [&amp;](int l, int r) -&gt; int
	&#123;
		int k &#x3D; LG2[r - l + 1];
		return max(f[l][k],f[r - (1 &lt;&lt; k) + 1][k]);
	&#125;;
 
	_init();
 
	while (q--)
	&#123;
		int l, r;
		cin &gt;&gt; l &gt;&gt; r;
 
		cout &lt;&lt; query(l, r) &lt;&lt; &quot;\n&quot;;
	&#125;
	
&#125;

int main()
&#123;
	cin.tie(nullptr)-&gt;sync_with_stdio(false);
	
	init();

	solve();
	
	return 0;
&#125;</code></pre>

<h4 id="高效质因数分解"><a href="#高效质因数分解" class="headerlink" title="高效质因数分解"></a>高效质因数分解</h4><p>这里有个结论：<mark>前 $N$ 个数的质数个数近似为：$\frac{N}{lnN}$</mark></p>
<p>于是乎，前 $\sqrt{1e9}$ 里面有 $3401$ 个质数，前 $1e5$ 里面有 $9592$ 个质数。 </p>
<blockquote>
<p><strong>时间复杂度：</strong>$O(\frac{\sqrt{n}}{ln(\sqrt{n})})$</p>
<p><strong>方法：</strong>线性筛优化加速</p>
</blockquote>
<p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">vector&lt;int&gt; primes;
void init(int n) &#x2F;&#x2F; 线性筛
&#123;
	vector&lt;int&gt; st(n + 1);
	for (int i &#x3D; 2; i &lt;&#x3D; n; i++)
	&#123;
		if (!st[i])	primes.push_back(i);
		for (int j &#x3D; 0; primes[j] &lt;&#x3D; n &#x2F; i; j++)
		&#123;
			st[primes[j] * i] &#x3D; true;
			if (i % primes[j] &#x3D;&#x3D; 0)	break;
		&#125;
	&#125;
&#125;
&#x2F;&#x2F; 高效筛法的过程
map&lt;int, int&gt; mp;
for (int i &#x3D; 1; i &lt;&#x3D; n; i++)
&#123;
    int x &#x3D; a[i];
    for (auto p : primes)
    &#123;
        if (p * p &gt; x)	break;
        if (x % p &#x3D;&#x3D; 0) &#x2F;&#x2F; if语句可视具体情况修改
        &#123;
            mp[p]++;
            while (x % p &#x3D;&#x3D; 0)	x &#x2F;&#x3D; p;
        &#125;
    &#125;
    if (x &gt; 1)	mp[x]++;
&#125;</code></pre>

<p><strong>推荐题目：</strong><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1771/problem/C">C. Hossam and Trainees</a></p>
<p><mark>代码：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

vector&lt;int&gt; primes;
void init(int n)
&#123;
	vector&lt;int&gt; st(n + 1);
	for (int i &#x3D; 2; i &lt;&#x3D; n; i++)
	&#123;
		if (!st[i])	primes.push_back(i);
		for (int j &#x3D; 0; primes[j] &lt;&#x3D; n &#x2F; i; j++)
		&#123;
			st[primes[j] * i] &#x3D; true;
			if (i % primes[j] &#x3D;&#x3D; 0)	break;
		&#125;
	&#125;
&#125;

void solve()
&#123;
	int n;
	cin &gt;&gt; n;

	vector&lt;int&gt; a(n + 1);
	for (int i &#x3D; 1; i &lt;&#x3D; n; i++)	cin &gt;&gt; a[i];

	map&lt;int, int&gt; mp;
	for (int i &#x3D; 1; i &lt;&#x3D; n; i++)
	&#123;
		int x &#x3D; a[i];
		for (auto p : primes)
		&#123;
			if (p * p &gt; x)	break;
			if (x % p &#x3D;&#x3D; 0)
			&#123;
				mp[p]++;
				while (x % p &#x3D;&#x3D; 0)	x &#x2F;&#x3D; p;
			&#125;
		&#125;
		if (x &gt; 1)	mp[x]++;
	&#125;

	for (auto [x, y] : mp)
		if (y &gt; 1)
			return cout &lt;&lt; &quot;YES\n&quot;, void();
	cout &lt;&lt; &quot;NO\n&quot;;
&#125;

int main()
&#123;
	cin.tie(nullptr)-&gt;sync_with_stdio(false);

	init(sqrt(1e9));
	
	int t;
	cin &gt;&gt; t;

	while (t--)
	&#123;
		solve();
	&#125;
	
	return 0;
&#125;</code></pre>



<h3 id="约数"><a href="#约数" class="headerlink" title="约数"></a>约数</h3><h4 id="求约数——试除法"><a href="#求约数——试除法" class="headerlink" title="求约数——试除法"></a>求约数——试除法</h4><blockquote>
<p><strong>时间复杂度：</strong> $O(N\sqrt{N})$</p>
</blockquote>
<p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">vector&lt;int&gt; get_divivors(int n)
&#123;
    vector&lt;int&gt;res;
    for(int i &#x3D; 1; i &lt;&#x3D; n &#x2F; i; i++)
    &#123;
        if(n % i &#x3D;&#x3D; 0)
        &#123;
            res.push_back(i);
            if(i !&#x3D; n &#x2F; i)  res.push_back(n &#x2F; i);
        &#125;
    &#125;
    return res;
&#125;</code></pre>

<h4 id="求约数——埃氏筛"><a href="#求约数——埃氏筛" class="headerlink" title="求约数——埃氏筛"></a>求约数——埃氏筛</h4><blockquote>
<p><strong>时间复杂度：</strong>$O(NlogN)$</p>
</blockquote>
<p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">const int N &#x3D; 2e5 + 10;
vector&lt;int&gt; factor[N];
void get_divivors(int n)
&#123;
    for (int i &#x3D; 1; i &lt;&#x3D; n; i++)
    	for (int j &#x3D; i; j &lt;&#x3D; n; j +&#x3D; i) 
            factor[j].emplace_back(i);
&#125;</code></pre>

<h4 id="最大公约数"><a href="#最大公约数" class="headerlink" title="最大公约数"></a>最大公约数</h4><blockquote>
<p><strong>时间复杂度：</strong>$O(logN)$</p>
</blockquote>
<p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">int gcd(int a,int b)
&#123;
    return b ? gcd(b,a % b) : a;
&#125;</code></pre>



<h3 id="扩展欧几里得"><a href="#扩展欧几里得" class="headerlink" title="扩展欧几里得"></a>扩展欧几里得</h3><blockquote>
<p>当方程符合 $ax + by &#x3D; gcd(a,b)$ 时，可以用扩展欧几里得算法求 $(x_0,y_0)$。</p>
<p>通解（不妨令 $d$ 为 $gcd(a,b)$，其中 $c$ 为任意整数）：</p>
<ul>
<li>$x &#x3D; x_0 + \frac{b}{d}c$</li>
<li>$y &#x3D; y_0 - \frac{a}{d}c$</li>
</ul>
<p><strong>注意：</strong> <mark>参数必须保证都是正数！</mark></p>
</blockquote>
<p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">ll exgcd(ll a,ll b,ll&amp; x,ll&amp; y)
&#123;
    if(!b)
    &#123;
        x &#x3D; 1,y &#x3D; 0;
        return a;
    &#125;
    ll d &#x3D; exgcd(b,a % b,y,x);
    y -&#x3D; a &#x2F; b * x;
    return d;
&#125;</code></pre>

<p><strong>推荐题目（tag：$2023$ 湖北省省赛，高效质因数分解 + $exgcd$）：</strong> <a target="_blank" rel="noopener" href="https://codeforces.com/gym/104337/problem/I">I. Step</a></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

typedef long long ll;

vector&lt;int&gt; get_prime(int n)&#x2F;&#x2F;线性筛法
&#123;
    vector&lt;int&gt; primes;
    vector&lt;bool&gt; st(n + 1);
    for (int i &#x3D; 2; i &lt;&#x3D; n; i++)
    &#123;
        if(!st[i])  primes.push_back(i);
        for (int j &#x3D; 0; primes[j] &lt;&#x3D; n &#x2F; i; j++)
        &#123;
            st[primes[j] * i] &#x3D; true;
            if(i % primes[j] &#x3D;&#x3D; 0)  break;
        &#125;
    &#125;
    return primes;
&#125;

ll exgcd(ll a,ll b,ll&amp; x,ll&amp; y)
&#123;
    if(!b)
    &#123;
        x &#x3D; 1,y &#x3D; 0;
        return a;
    &#125;
    ll d &#x3D; exgcd(b,a % b,y,x);
    y -&#x3D; a &#x2F; b * x;
    return d;
&#125;

int main()
&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);

    int n;
    cin &gt;&gt; n;

    vector&lt;int&gt; a(n + 1);
    for (int i &#x3D; 1; i &lt;&#x3D; n; i++)    cin &gt;&gt; a[i];

    &#x2F;&#x2F; 质因数分解
    auto primes &#x3D; get_prime(1e7);
    map&lt;int, int&gt; mp;
    for (int i &#x3D; 1; i &lt;&#x3D; n; i++)
    &#123;
        ll x &#x3D; a[i];
        for (int j &#x3D; 0; j &lt; primes.size(); j++)
        &#123;
            int p &#x3D; primes[j];
            if ((ll)p * p &gt; x)    break; 
            int cnt &#x3D; 0;
            while (x % p &#x3D;&#x3D; 0)
            &#123;
                x &#x2F;&#x3D; p;
                cnt++;
            &#125;
            if (cnt)    mp[p] &#x3D; max(mp[p], cnt);
        &#125;
        if (x &gt; 1)    mp[x] &#x3D; max(mp[x], 1);
    &#125;

    mp[2]++; &#x2F;&#x2F; 2倍
    map&lt;int, ll&gt; num;
    for (auto [x, y] : mp)
    &#123;
        ll t &#x3D; 1;
        for (int i &#x3D; 1; i &lt;&#x3D; y; i++)    t *&#x3D; x;
        num[x] &#x3D; t;
    &#125;

    &#x2F;&#x2F; 枚举质因数
    vector&lt;int&gt; v;
    for (auto [x, y] : mp)  
        v.push_back(x);

    int cnt &#x3D; v.size();
    ll ans &#x3D; 1e18;
    for (int i &#x3D; 0; i &lt; 1 &lt;&lt; cnt; i++)
    &#123;
        ll a &#x3D; 1, b &#x3D; 1;
        for (int j &#x3D; 0; j &lt; cnt; j++)
        &#123;
            if (i &gt;&gt; j &amp; 1) a *&#x3D; num[v[j]];
            else    b *&#x3D; num[v[j]];
        &#125;

        &#x2F;&#x2F; ax - by &#x3D; 1
        ll x, y;
        exgcd(a, b, x, y);
        ll res &#x3D; (-y % a + a) % a;
        if (!res)   res &#x3D; a;
        ans &#x3D; min(ans, res * b);
    &#125;

    cout &lt;&lt; ans &lt;&lt; &quot;\n&quot;;

    return 0;
&#125;</code></pre>

<h3 id="矩阵快速幂"><a href="#矩阵快速幂" class="headerlink" title="矩阵快速幂"></a>矩阵快速幂</h3><blockquote>
<p>假设当前层的未知数有 $n$ 个：$F_1,F_2,\cdots,F_n$，需要利用上一层状态来快速求解答案，因此我们要解公式：</p>
<p>$[F_{i_1},F_{i_2},\cdots,F_{i_n}] &#x3D; [F_{i-1_1},F_{i-1_2},\cdots,F_{i-1_n}]\times A$</p>
<p>只需解出转移矩阵 $A$ 即可。显然，有 $n$ 个未知数，$A$ 矩阵就是 $N \times N$ 大小的。</p>
<p><strong>模板使用指南：</strong></p>
<ul>
<li>矩阵中仅存有二维数组，目的是方便直接手动录入转移矩阵；</li>
<li>不过里面的二维数组每次记得要先初始化再使用！</li>
</ul>
</blockquote>
<p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">const int mod &#x3D; 1e9 + 7;
const int N &#x3D; 3;
struct Matrix
&#123;
    int g[N][N];
&#125;;

Matrix operator* (const Matrix&amp; a, const Matrix&amp; b) &#x2F;&#x2F; 重载 * 运算法，支持矩阵乘法
&#123;
    Matrix res;
    memset(res.g, 0, sizeof(res.g));
    for (int i &#x3D; 0; i &lt; N; i++)
        for (int j &#x3D; 0; j &lt; N; j++)
            for (int k &#x3D; 0; k &lt; N; k++)
                res.g[i][j] &#x3D; (res.g[i][j] + (ll)a.g[i][k] * b.g[k][j] % mod) % mod;
    return res; 
&#125;

Matrix fpow(Matrix a, int b) &#x2F;&#x2F; 矩阵快速幂
&#123;
    Matrix res;
    memset(res.g, 0, sizeof(res.g));
    for (int i &#x3D; 0; i &lt; N; i++) res.g[i][i] &#x3D; 1;
    while (b)
    &#123;
        if (b &amp; 1)  res &#x3D; res * a;
        a &#x3D; a * a;
        b &gt;&gt;&#x3D; 1;
    &#125;
    return res;
&#125;</code></pre>

<p><strong>推荐题目（tag：$2022$ 蓝桥杯省赛真题）：</strong><a target="_blank" rel="noopener" href="https://www.acwing.com/problem/content/4409/">积木画</a></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

typedef long long ll;

const int mod &#x3D; 1e9 + 7;
const int N &#x3D; 3;
struct Matrix
&#123;
    int g[N][N];
&#125;;

Matrix operator* (const Matrix&amp; a, const Matrix&amp; b) &#x2F;&#x2F; 重载 * 运算法，支持矩阵乘法
&#123;
    Matrix res;
    memset(res.g, 0, sizeof(res.g));
    for (int i &#x3D; 0; i &lt; N; i++)
        for (int j &#x3D; 0; j &lt; N; j++)
            for (int k &#x3D; 0; k &lt; N; k++)
                res.g[i][j] &#x3D; (res.g[i][j] + (ll)a.g[i][k] * b.g[k][j] % mod) % mod;
    return res; 
&#125;

Matrix fpow(Matrix a, int b)
&#123;
    Matrix res;
    memset(res.g, 0, sizeof(res.g));
    for (int i &#x3D; 0; i &lt; N; i++) res.g[i][i] &#x3D; 1;
    while (b)
    &#123;
        if (b &amp; 1)  res &#x3D; res * a;
        a &#x3D; a * a;
        b &gt;&gt;&#x3D; 1;
    &#125;
    return res;
&#125;

Matrix A &#x3D; 
&#123;
    &#123;
        &#123;1, 2, 1&#125;,
        &#123;0, 1, 1&#125;,
        &#123;1, 0, 0&#125;
    &#125;
&#125;;

int main()
&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);

    int n;
    cin &gt;&gt; n;

    &#x2F;**
     * res[3][3] &#x3D; init[3] * A[3][3] ^ n
    *&#x2F;
    auto res &#x3D; fpow(A, n);

    cout &lt;&lt; res.g[0][0];
    return 0;
&#125;</code></pre>



<h3 id="线性基"><a href="#线性基" class="headerlink" title="线性基"></a>线性基</h3><blockquote>
<p>高斯消元（求线性基时，是一种<strong>离线做法</strong>）中，有 $k(k \le n)$ 个线性基：</p>
<ul>
<li>若 $k &lt; n$ ，说明这 $n$ 个向量是线性相关的，则必然可以凑出 $0$ 向量。</li>
<li>若 $k &#x3D; n$，则线性无关，无法凑出 $0$ 向量。</li>
</ul>
</blockquote>
<p><mark>封装模板：</mark></p>
<ul>
<li><strong>高斯消元版（离线）</strong></li>
</ul>
<pre class="language-c++" data-language="c++"><code class="language-c++">template&lt;typename T&gt;
struct Linear_basis
&#123;
    int n, k;
    vector&lt;T&gt; a;

    Linear_basis(const vector&lt;T&gt; &amp;a): a(a), n(a.size()) &#123;&#125;

    void Gauss() &#123;
        k &#x3D; 0;
        for (int i &#x3D; 62; i &gt;&#x3D; 0; i--) &#123;
            for (int j &#x3D; k; j &lt; n; j++) &#123;
                if (a[j] &gt;&gt; i &amp; 1) &#123;
                    swap(a[j], a[k]);
                    break;
                &#125;
            &#125;
            if (!(a[k] &gt;&gt; i &amp; 1))   continue;

            for (int j &#x3D; 0; j &lt; n; j++) &#123;
                if (j &#x3D;&#x3D; k) continue;
                if (a[j] &gt;&gt; i &amp; 1)  a[j] ^&#x3D; a[k];
            &#125;
            k++;
            if (k &#x3D;&#x3D; n) break;
        &#125;
    &#125;

    T get_max() &#123;
        T res &#x3D; 0;
        for (int i &#x3D; 0; i &lt; k; i++) res ^&#x3D; a[i];
        return res;
    &#125;

    T get_min() &#123;
        if (k &lt; n)  return 0;
        else    return a[k - 1];
    &#125;

    T get_kth(T m) &#123; &#x2F;&#x2F; 求第 m 小
        if (k &lt; n)  m--;
        if ((1ll &lt;&lt; k) - 1 &lt; m) return -1;
        T res &#x3D; 0;
        for (int i &#x3D; 0; i &lt; k; i++)
            if (m &gt;&gt; i &amp; 1)
                res ^&#x3D; a[k - i - 1];
        return res;
    &#125;
&#125;;</code></pre>

<ul>
<li><strong>贪心版（在线）</strong></li>
</ul>
<pre class="language-c++" data-language="c++"><code class="language-c++">template&lt;typename T&gt;
struct Linear_basis
&#123;
    bool flag;&#x2F;&#x2F;判断 0 的存在
    vector&lt;T&gt; d;

    Linear_basis(): flag(false) &#123;
        d.resize(63);
    &#125;
    bool add(T x) &#123; &#x2F;&#x2F; 每次插入一个数
        for(int i &#x3D; 62; ~i;i--)
            if(x &gt;&gt; i &amp; 1)
            &#123;
                if(!d[i])    return d[i] &#x3D; x,true;
                x ^&#x3D; d[i];
            &#125;
        flag &#x3D; true;
        return false;
    &#125;;

    T get_max() &#123; &#x2F;&#x2F;选取任意个数异或的最大值
        T res &#x3D; 0;
        for(int i &#x3D; 62; ~i;i--)
        &#123;
            res &#x3D; max(res,res ^ d[i]);
        &#125;
        return res;
    &#125;;

    T get_min() &#123; &#x2F;&#x2F;选取任意个数异或的最小值
        if(flag)    return 0;
        for(int i &#x3D; 0; i &lt;&#x3D; 62;i++)
            if(d[i])    return d[i];
        return -1;
    &#125;;
&#125;;</code></pre>

<p><strong>推荐题目（$2023CCPC$ 桂林站银牌题）：</strong><a target="_blank" rel="noopener" href="https://codeforces.com/gym/482805/problem/C">C. Master of Both IV</a></p>
<p><mark>代码：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

typedef long long ll;

template&lt;typename T&gt;
struct Linear_basis
&#123;
    bool flag;&#x2F;&#x2F;判断 0 的存在
    vector&lt;T&gt; d;

    Linear_basis(): flag(false) &#123;
        d.resize(63);
    &#125;
    bool add(T x) &#123; &#x2F;&#x2F; 每次插入一个数
        for(int i &#x3D; 62; ~i;i--)
            if(x &gt;&gt; i &amp; 1)
            &#123;
                if(!d[i])    return d[i] &#x3D; x,true;
                x ^&#x3D; d[i];
            &#125;
        flag &#x3D; true;
        return false;
    &#125;;

    T get_max() &#123; &#x2F;&#x2F;选取任意个数异或的最大值
        T res &#x3D; 0;
        for(int i &#x3D; 62; ~i;i--)
        &#123;
            res &#x3D; max(res,res ^ d[i]);
        &#125;
        return res;
    &#125;;

    T get_min() &#123; &#x2F;&#x2F;选取任意个数异或的最小值
        if(flag)    return 0;
        for(int i &#x3D; 0; i &lt;&#x3D; 62;i++)
            if(d[i])    return d[i];
        return -1;
    &#125;;
&#125;;

const int mod &#x3D; 998244353;

ll fpow(ll a,ll b)
&#123;
   ll res &#x3D; 1;
   a %&#x3D; mod;
   while(b)
   &#123;
       if(b &amp; 1)   res &#x3D; res * a % mod;
       a &#x3D; a * a % mod;
       b &gt;&gt;&#x3D; 1;
   &#125;
   return res;
&#125;

const int N &#x3D; 2e5 + 10;
vector&lt;int&gt; factor[N];
void get_divivors(int n)
&#123;
    for (int i &#x3D; 1; i &lt;&#x3D; n; i++)
    	for (int j &#x3D; i; j &lt;&#x3D; n; j +&#x3D; i) 
            factor[j].emplace_back(i);
&#125;

void solve()
&#123;
    int n;
    cin &gt;&gt; n;

    vector&lt;int&gt; a(n + 1);
    Linear_basis&lt;ll&gt; lb;
    int k &#x3D; 0;
    map&lt;int, int&gt; cnt;
    for (int i &#x3D; 1; i &lt;&#x3D; n; i++)    
    &#123;
        cin &gt;&gt; a[i];
        if (!lb.add(a[i]))  k++;

        cnt[a[i]]++;
    &#125;
    
    ll res &#x3D; fpow(2, k) - 1;
    for (auto [x, y] : cnt)
    &#123;
        Linear_basis&lt;ll&gt; tlb;
        int tk &#x3D; 0;
        for (auto t : factor[x])
        &#123;
            if (cnt.count(t))    
            &#123;
                if (!tlb.add(t))    tk +&#x3D; cnt[t];
                else    tk +&#x3D; cnt[t] - 1;
            &#125;
        &#125;
        res &#x3D; (res + fpow(2, tk)) % mod;
    &#125;

    cout &lt;&lt; res &lt;&lt; &quot;\n&quot;;
&#125;

int main()
&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);

    get_divivors(2e5);

    int t;
    cin &gt;&gt; t;

    while (t--)
    &#123;
        solve();
    &#125;
    
    return 0;
&#125;</code></pre>



<h2 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h2><h3 id="并查集"><a href="#并查集" class="headerlink" title="并查集"></a>并查集</h3><p><mark>封装模板：</mark></p>
<pre class="language-c" data-language="c"><code class="language-c">template<span class="token operator">&lt;</span>typename T<span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">DSU</span> <span class="token punctuation">&#123;</span>
	vector<span class="token operator">&lt;</span>T<span class="token operator">></span> p<span class="token punctuation">,</span> sz<span class="token punctuation">;</span>
	<span class="token function">DSU</span><span class="token punctuation">(</span>T n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">p</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sz</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">iota</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
	<span class="token comment">//初始化</span>
	<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		p<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">iota</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		sz<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">//找父节点</span>
	T <span class="token function">find</span><span class="token punctuation">(</span>T x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> x <span class="token operator">=</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> x<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">//合并集合</span>
	bool <span class="token function">merge</span><span class="token punctuation">(</span>T x<span class="token punctuation">,</span> T y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		x <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		y <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>
		sz<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> sz<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
		p<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
		<span class="token keyword">return</span> true<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">//判断是否同一集合</span>
	bool <span class="token function">same</span><span class="token punctuation">(</span>T x<span class="token punctuation">,</span> T y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">find</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
	<span class="token comment">//集合大小</span>
	T <span class="token function">size</span><span class="token punctuation">(</span>T x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> sz<span class="token punctuation">[</span><span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<p><strong>推荐题目（湖北省赛金牌题，并查集的高级应用）：</strong><a target="_blank" rel="noopener" href="https://codeforces.com/gym/105139/problem/I">I. Colorful Tree</a></p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;bits/stdc++.h></span></span>

using namespace std<span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">HLD</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> n<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> sz<span class="token punctuation">,</span> top<span class="token punctuation">,</span> depth<span class="token punctuation">,</span> fa<span class="token punctuation">,</span> in<span class="token punctuation">,</span> out<span class="token punctuation">,</span> seq<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> g<span class="token punctuation">;</span>
    <span class="token keyword">int</span> ts<span class="token punctuation">;</span>

	<span class="token function">HLD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token function">HLD</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">init</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        this<span class="token operator">-></span>n <span class="token operator">=</span> n<span class="token punctuation">;</span>
        sz<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        top<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        depth<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fa<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        in<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        seq<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ts <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        g<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

	<span class="token keyword">void</span> <span class="token function">addEdge</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
		g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		top<span class="token punctuation">[</span>root<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">;</span>
		depth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> depth<span class="token punctuation">[</span>root<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">dfs_sz</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">dfs_hld</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
 
    <span class="token keyword">void</span> <span class="token function">dfs_sz</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fa<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>it <span class="token operator">==</span> fa<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        sz<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>j <span class="token operator">:</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            fa<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">;</span>
            depth<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">dfs_sz</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sz<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+=</span> sz<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>sz<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> sz<span class="token punctuation">[</span>g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token function">swap</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">void</span> <span class="token function">dfs_hld</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        in<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span>ts<span class="token punctuation">;</span>
        seq<span class="token punctuation">[</span>in<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> j <span class="token operator">:</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            top<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">?</span> top<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">:</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">dfs_hld</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        out<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> ts<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">int</span> <span class="token function">lca</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>top<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">!=</span> top<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>depth<span class="token punctuation">[</span>top<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">></span> depth<span class="token punctuation">[</span>top<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                u <span class="token operator">=</span> fa<span class="token punctuation">[</span>top<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> 
            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                v <span class="token operator">=</span> fa<span class="token punctuation">[</span>top<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">&lt;</span> depth<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">?</span> u <span class="token operator">:</span> v<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">int</span> <span class="token function">dist</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> depth<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> depth<span class="token punctuation">[</span><span class="token function">lca</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    bool <span class="token function">in_subtree</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> in<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> in<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> in<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> out<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">int</span> <span class="token function">jump</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">&lt;</span> k<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">int</span> d <span class="token operator">=</span> depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">-</span> k<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>depth<span class="token punctuation">[</span>top<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">></span> d<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            u <span class="token operator">=</span> fa<span class="token punctuation">[</span>top<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> seq<span class="token punctuation">[</span>in<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">-</span> depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> d<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">int</span> <span class="token function">rooted_lca</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">lca</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">lca</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">lca</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

template<span class="token operator">&lt;</span>typename T<span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">DSU</span> <span class="token punctuation">&#123;</span>
	vector<span class="token operator">&lt;</span>T<span class="token operator">></span> p<span class="token punctuation">,</span> sz<span class="token punctuation">;</span>
	<span class="token function">DSU</span><span class="token punctuation">(</span>T n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">p</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sz</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">iota</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
	<span class="token comment">//初始化</span>
	<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		p<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">iota</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		sz<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">//找父节点</span>
	T <span class="token function">find</span><span class="token punctuation">(</span>T x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> x <span class="token operator">=</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> x<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">//合并集合</span>
	bool <span class="token function">merge</span><span class="token punctuation">(</span>T x<span class="token punctuation">,</span> T y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		x <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		y <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>
		sz<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> sz<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
		p<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
		<span class="token keyword">return</span> true<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">//判断是否同一集合</span>
	bool <span class="token function">same</span><span class="token punctuation">(</span>T x<span class="token punctuation">,</span> T y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">find</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
	<span class="token comment">//集合大小</span>
	T <span class="token function">size</span><span class="token punctuation">(</span>T x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> sz<span class="token punctuation">[</span><span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Diameter</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">int</span> u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> len<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">int</span> n<span class="token punctuation">,</span> q<span class="token punctuation">;</span>
	cin <span class="token operator">>></span> n <span class="token operator">>></span> q<span class="token punctuation">;</span>

	HLD <span class="token function">hld</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>
		cin <span class="token operator">>></span> a <span class="token operator">>></span> b<span class="token punctuation">;</span>
		hld<span class="token punctuation">.</span><span class="token function">addEdge</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	hld<span class="token punctuation">.</span><span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	DSU<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">dsu</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">color</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> mp<span class="token punctuation">;</span> <span class="token comment">// 按时间顺序</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> q<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token keyword">int</span> u<span class="token punctuation">,</span> v<span class="token punctuation">;</span>
		cin <span class="token operator">>></span> u <span class="token operator">>></span> v<span class="token punctuation">;</span>

		<span class="token keyword">int</span> p <span class="token operator">=</span> hld<span class="token punctuation">.</span><span class="token function">lca</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> x <span class="token operator">:</span> <span class="token punctuation">&#123;</span>u<span class="token punctuation">,</span> v<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>true<span class="token punctuation">)</span>
			<span class="token punctuation">&#123;</span>
				<span class="token keyword">int</span> y <span class="token operator">=</span> dsu<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">==</span> n <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">||</span> hld<span class="token punctuation">.</span>depth<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">&lt;</span> hld<span class="token punctuation">.</span>depth<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span>
				<span class="token punctuation">&#123;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">&#125;</span>
				color<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				mp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
				dsu<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>hld<span class="token punctuation">.</span>fa<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>	
	<span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>color<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>	mp<span class="token punctuation">[</span>q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	color<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	dsu<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">res</span><span class="token punctuation">(</span>q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	vector<span class="token operator">&lt;</span>Diameter<span class="token operator">></span> <span class="token function">dia</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>	dia<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>i<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> merge <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>Diameter a<span class="token punctuation">,</span> Diameter b<span class="token punctuation">)</span> <span class="token operator">-></span> Diameter
	<span class="token punctuation">&#123;</span>
		Diameter res <span class="token operator">=</span> a<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>len <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>len<span class="token punctuation">)</span>	res <span class="token operator">=</span> b<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> x <span class="token operator">:</span> <span class="token punctuation">&#123;</span>a<span class="token punctuation">.</span>u<span class="token punctuation">,</span> a<span class="token punctuation">.</span>v<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> y <span class="token operator">:</span> <span class="token punctuation">&#123;</span>b<span class="token punctuation">.</span>u<span class="token punctuation">,</span> b<span class="token punctuation">.</span>v<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
			<span class="token punctuation">&#123;</span>
				<span class="token keyword">int</span> d <span class="token operator">=</span> hld<span class="token punctuation">.</span><span class="token function">dist</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">></span> res<span class="token punctuation">.</span>len<span class="token punctuation">)</span>	res <span class="token operator">=</span> <span class="token punctuation">&#123;</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> d<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> res<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> cal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">void</span>
	<span class="token punctuation">&#123;</span>
		color<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>

		<span class="token keyword">auto</span> nxt_cal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">void</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">!=</span> color<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token keyword">return</span><span class="token punctuation">;</span>

			<span class="token keyword">int</span> x <span class="token operator">=</span> dsu<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">=</span> dsu<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
			dsu<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
			dia<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>dia<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> dia<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ans <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>ans<span class="token punctuation">,</span> dia<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> hld<span class="token punctuation">.</span>g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token function">nxt_cal</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>hld<span class="token punctuation">.</span>fa<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token function">nxt_cal</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> hld<span class="token punctuation">.</span>fa<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> q<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> u <span class="token operator">:</span> mp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token function">cal</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ans <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	dsu<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>	dia<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>i<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	color<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> q<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> x <span class="token operator">:</span> mp<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token function">cal</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ans <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> q<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>	cout <span class="token operator">&lt;&lt;</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> t<span class="token punctuation">;</span>
	cin <span class="token operator">>></span> t<span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>t<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="最近公共祖先（-lca-）"><a href="#最近公共祖先（-lca-）" class="headerlink" title="最近公共祖先（$lca$）"></a>最近公共祖先（$lca$）</h3><blockquote>
<p><strong>应用：</strong></p>
<ol>
<li>获取两个点之间的路径与距离，距离：<code>dist[a][b] = depth[a] + depth[b] - 2 × depth[p] </code></li>
<li>在 $(a,b)$ 路径上的每条边加上一个权值 $c$，树上差分：</li>
</ol>
<ul>
<li>边权树上差分：<code>d[a] += c, d[b] += c, d[p] -= 2c</code></li>
<li>点权树上差分：<code>d[a] += c, d[b] += c, d[p] -= c, d[fa[p]] -= c</code></li>
</ul>
</blockquote>
<p><mark>hld 封装模板：</mark></p>
<blockquote>
<p><strong>使用方法：</strong></p>
<ul>
<li>创建：HLD hld(n+1);</li>
<li>加边：hld.addEdge(u,v);</li>
<li>工作：hld.work();</li>
</ul>
</blockquote>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">HLD</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> n<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> sz<span class="token punctuation">,</span> top<span class="token punctuation">,</span> depth<span class="token punctuation">,</span> fa<span class="token punctuation">,</span> in<span class="token punctuation">,</span> out<span class="token punctuation">,</span> seq<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> g<span class="token punctuation">;</span>
    <span class="token keyword">int</span> ts<span class="token punctuation">;</span>

	<span class="token function">HLD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token function">HLD</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">init</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        this<span class="token operator">-></span>n <span class="token operator">=</span> n<span class="token punctuation">;</span>
        sz<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        top<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        depth<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fa<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        in<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        seq<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ts <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        g<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

	<span class="token keyword">void</span> <span class="token function">addEdge</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
		g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		top<span class="token punctuation">[</span>root<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">;</span>
		depth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> depth<span class="token punctuation">[</span>root<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">dfs_sz</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">dfs_hld</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
 
    <span class="token keyword">void</span> <span class="token function">dfs_sz</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fa<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>it <span class="token operator">==</span> fa<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        sz<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>j <span class="token operator">:</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            fa<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">;</span>
            depth<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">dfs_sz</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sz<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+=</span> sz<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>sz<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> sz<span class="token punctuation">[</span>g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token function">swap</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">void</span> <span class="token function">dfs_hld</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        in<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span>ts<span class="token punctuation">;</span>
        seq<span class="token punctuation">[</span>in<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> j <span class="token operator">:</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            top<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">?</span> top<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">:</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">dfs_hld</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        out<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> ts<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">int</span> <span class="token function">lca</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>top<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">!=</span> top<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>depth<span class="token punctuation">[</span>top<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">></span> depth<span class="token punctuation">[</span>top<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                u <span class="token operator">=</span> fa<span class="token punctuation">[</span>top<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> 
            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                v <span class="token operator">=</span> fa<span class="token punctuation">[</span>top<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">&lt;</span> depth<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">?</span> u <span class="token operator">:</span> v<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">int</span> <span class="token function">dist</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> depth<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> depth<span class="token punctuation">[</span><span class="token function">lca</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    bool <span class="token function">in_subtree</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> in<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> in<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> in<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> out<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">int</span> <span class="token function">jump</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">&lt;</span> k<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">int</span> d <span class="token operator">=</span> depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">-</span> k<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>depth<span class="token punctuation">[</span>top<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">></span> d<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            u <span class="token operator">=</span> fa<span class="token punctuation">[</span>top<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> seq<span class="token punctuation">[</span>in<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">-</span> depth<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> d<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">int</span> <span class="token function">rooted_lca</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">lca</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">lca</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">lca</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>


<p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">vector&lt;vector&lt;int&gt;&gt; g(n + 1); &#x2F;&#x2F; 存图方式
vector&lt;vector&lt;int&gt;&gt; fa(n + 1, vector&lt;int&gt;(16));
vector&lt;int&gt; depth(n + 1, 0x3f3f3f3f);
auto bfs &#x3D; [&amp;](int root) -&gt; void &#x2F;&#x2F; 初始化
&#123;
    queue&lt;int&gt; q;
    q.push(root);   
    depth[0] &#x3D; 0, depth[root] &#x3D; 1;
    while (!q.empty())
    &#123;
        auto u &#x3D; q.front();
        q.pop();
        for (auto v : g[u])
        &#123;
            if (depth[v] &gt; depth[u] + 1)
            &#123;
                q.push(v);
                depth[v] &#x3D; depth[u] + 1;
                fa[v][0] &#x3D; u;
                for (int k &#x3D; 1; k &lt;&#x3D; 15; k++)
                    fa[v][k] &#x3D; fa[fa[v][k - 1]][k - 1];
            &#125;
        &#125;
    &#125;
&#125;;

auto lca &#x3D; [&amp;](int a, int b) -&gt; int
&#123;
    if (depth[a] &lt; depth[b])  swap(a, b);

    for (int k &#x3D; 15; k &gt;&#x3D; 0; k--)
        if(depth[fa[a][k]] &gt;&#x3D; depth[b])
            a &#x3D; fa[a][k];

    if (a &#x3D;&#x3D; b) return a;

    for (int k &#x3D; 15; k &gt;&#x3D; 0; k--)
        if (fa[a][k] !&#x3D; fa[b][k])
            a &#x3D; fa[a][k], b &#x3D; fa[b][k];
    return fa[a][0];
&#125;;</code></pre>

<p><strong>推荐题目（$2023$ 蓝桥杯省赛最后一题）：</strong><a target="_blank" rel="noopener" href="https://www.acwing.com/problem/content/description/4966/">砍树</a></p>
<p><mark>代码：</mark></p>
<ul>
<li>树上差分（应用 $2$）的经典使用：</li>
</ul>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

typedef pair&lt;int, int&gt; pii;

int main()
&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);

    int n, m;
    cin &gt;&gt; n &gt;&gt; m;

    vector&lt;vector&lt;pii&gt;&gt; g(n + 1);
    for (int i &#x3D; 1; i &lt; n; i++)
    &#123;
        int a, b;
        cin &gt;&gt; a &gt;&gt; b;
        g[a].push_back(&#123;b, i&#125;);
        g[b].push_back(&#123;a, i&#125;);
    &#125;

    vector&lt;pii&gt; path(m + 1);
    for (int i &#x3D; 1; i &lt;&#x3D; m; i++)    cin &gt;&gt; path[i].first &gt;&gt; path[i].second;

    vector&lt;vector&lt;int&gt;&gt; fa(n + 1, vector&lt;int&gt;(18));
    vector&lt;int&gt; depth(n + 1, 0x3f3f3f3f);
    auto bfs &#x3D; [&amp;](int root) -&gt; void 
    &#123;
        queue&lt;int&gt; q;
        q.push(root);
        depth[0] &#x3D; 0, depth[root] &#x3D; 1;
        while (!q.empty())
        &#123;
            auto u &#x3D; q.front();
            q.pop();
            for (auto [v, id] : g[u])
            &#123;
                if (depth[v] &gt; depth[u] + 1)
                &#123;
                    q.push(v);
                    depth[v] &#x3D; depth[u] + 1;
                    fa[v][0] &#x3D; u;
                    for (int k &#x3D; 1; k &lt;&#x3D; 17; k++)
                        fa[v][k] &#x3D; fa[fa[v][k - 1]][k - 1];
                &#125;
            &#125;
        &#125;
    &#125;;
    bfs(1);
    
    auto lca &#x3D; [&amp;](int a, int b) -&gt; int
    &#123;
        if (depth[a] &lt; depth[b])  swap(a, b);
    
        for (int k &#x3D; 17; k &gt;&#x3D; 0; k--)
            if(depth[fa[a][k]] &gt;&#x3D; depth[b])
                a &#x3D; fa[a][k];
    
        if (a &#x3D;&#x3D; b) return a;
    
        for (int k &#x3D; 17; k &gt;&#x3D; 0; k--)
            if (fa[a][k] !&#x3D; fa[b][k])
                a &#x3D; fa[a][k], b &#x3D; fa[b][k];
        return fa[a][0];
    &#125;;

    vector&lt;int&gt; w(n + 1);
    for (int i &#x3D; 1; i &lt;&#x3D; m; i++)
    &#123;
        int a &#x3D; path[i].first, b &#x3D; path[i].second;
        w[a] ++, w[b] ++, w[lca(a, b)] -&#x3D; 2;
    &#125;

    int res_id &#x3D; -1;
    function&lt;int(int, int)&gt; dfs &#x3D; [&amp;](int u, int father) -&gt; int
    &#123;
        int res &#x3D; w[u];
        for (auto [v, id] : g[u])
        &#123;
            if (v &#x3D;&#x3D; father)    continue;
            int t &#x3D; dfs(v, u);

            if (t &#x3D;&#x3D; m) res_id &#x3D; max(res_id, id);   
            res +&#x3D; t;
        &#125;
        return res;
    &#125;;
    dfs(1, -1);

    cout &lt;&lt; res_id &lt;&lt; &quot;\n&quot;;
    return 0;
&#125;</code></pre>



<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><h3 id="差分"><a href="#差分" class="headerlink" title="差分"></a>差分</h3><h4 id="一维差分"><a href="#一维差分" class="headerlink" title="一维差分"></a>一维差分</h4><blockquote>
<p><strong>核心代码：</strong></p>
<p>在区间 $[l,r]$ 加上一个数 $c$：$b[l] +&#x3D; c, b[r + 1] -&#x3D; c;$</p>
</blockquote>
<p><mark>模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">auto insert &#x3D; [&amp;](int l, int r, int c) -&gt; void &#x2F;&#x2F; 预处理
&#123;
    b[l] +&#x3D; c;
    b[r + 1] -&#x3D; c;
&#125;;

for (int i &#x3D; 1; i &lt;&#x3D; n; i++)    b[i] +&#x3D; b[i - 1]; &#x2F;&#x2F; 求一遍前缀和即为现数组</code></pre>

<p><strong>推荐题目：</strong><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1955/problem/E">E. Long Inversions</a></p>
<p><mark>代码：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

void solve()
&#123;
    int n;
    cin &gt;&gt; n;

    string s;
    cin &gt;&gt; s;
    s &#x3D; &quot; &quot; + s;

    int res &#x3D; 0;
    for (int i &#x3D; n; i &gt;&#x3D; 1; i--)
    &#123;
        vector&lt;int&gt; d(n + 1);
        bool ok &#x3D; true;
        for (int j &#x3D; 1; j &lt;&#x3D; n; j++)
        &#123;
            d[j] +&#x3D; d[j - 1];
            d[j] &amp;&#x3D; 1;
            int c &#x3D; s[j] - &#39;0&#39;;
            if ((c ^ d[j]) &#x3D;&#x3D; 0)
            &#123;
                d[j]++;
                if (j + i &lt;&#x3D; n) d[j + i] --;
                if (j + i - 1 &gt; n)
                &#123;
                    ok &#x3D; false;
                    break;
                &#125;
            &#125;
        &#125;
        if (ok)
        &#123;
            res &#x3D; i;
            break;
        &#125;
    &#125;
    cout &lt;&lt; res &lt;&lt; &quot;\n&quot;;
&#125;

int main()
&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);

    int t;
    cin &gt;&gt; t;
    while (t--)
    &#123;
        solve();
    &#125;
    
    return 0;
&#125;</code></pre>



<h3 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h3><h4 id="双链表"><a href="#双链表" class="headerlink" title="双链表"></a>双链表</h4><p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">struct Node
&#123;
    string data;
&#125;;

const int N &#x3D; 1e6 + 10;
struct DoubleLinkList
&#123;
    string e[N]; &#x2F;&#x2F; 存结点对应的值; (如果结点存的值比较多, 可以用Node存储)
    int head, tail, idx, l[N], r[N];&#x2F;&#x2F; head:头指针; tail: 尾指针;
    map&lt;string, int&gt; mp; &#x2F;&#x2F; 存该值对应的在链表中的下标
    DoubleLinkList () &#123; &#x2F;&#x2F; 自动初始化
        init();
    &#125;
    void init() &#123; &#x2F;&#x2F; 初始化
        head &#x3D; 0;
        tail &#x3D; N - 1;
        r[head] &#x3D; tail;
        l[tail] &#x3D; head;
        idx &#x3D; 1;
    &#125;
    void add(int k, string s) &#123; &#x2F;&#x2F; 在第k个数的后面插入一个数
        mp[s] &#x3D; idx;
        e[idx] &#x3D; s;
        r[idx] &#x3D; r[k];
        l[idx] &#x3D; k;
        l[r[k]] &#x3D; idx;
        r[k] &#x3D; idx;
        idx++;
    &#125;
    void del(int k, bool keep &#x3D; false) &#123; &#x2F;&#x2F; 功能:删除第几个(插入的)数; keep: 是否保留
        r[l[k]] &#x3D; r[k];
        l[r[k]] &#x3D; l[k];
        if (!keep)  mp.erase(e[k]);
    &#125;
    bool isEmpty() &#123; &#x2F;&#x2F; 判断链表是否为空
        return l[tail] &#x3D;&#x3D; head;
    &#125;
    void print() &#123; &#x2F;&#x2F; 打印双链表
        for (int i &#x3D; r[head]; i !&#x3D; tail; i &#x3D; r[i])
            cout &lt;&lt; e[i] &lt;&lt; &quot; \n&quot;[i &#x3D;&#x3D; tail];
    &#125;
&#125;lis;</code></pre>

<p><strong>推荐题目：</strong><a target="_blank" rel="noopener" href="https://ac.nowcoder.com/acm/contest/77922/G">排队</a></p>
<p>当有成型的双链表的板子后，这道题就会变得很容易。</p>
<p><mark>代码：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

array&lt;string, 2&gt; arr;

const int N &#x3D; 3e5 + 10;

struct DoubleLinkList
&#123;
    string e[N];
    int head, tail, idx, l[N], r[N];
    map&lt;string, int&gt; mp;
    void init() &#123;
        head &#x3D; 0;
        tail &#x3D; N - 1;
        r[head] &#x3D; tail;
        l[tail] &#x3D; head;
        idx &#x3D; 1;
    &#125;
    void add(int k, string s) &#123; &#x2F;&#x2F; 在第k个数的后面插入一个数
        mp[s] &#x3D; idx;
        e[idx] &#x3D; s;
        r[idx] &#x3D; r[k];
        l[idx] &#x3D; k;
        l[r[k]] &#x3D; idx;
        r[k] &#x3D; idx;
        idx++;
    &#125;
    void del(int k, bool keep) &#123;&#x2F;&#x2F;keep: 是否保留
        r[l[k]] &#x3D; r[k];
        l[r[k]] &#x3D; l[k];
        if (!keep)  mp.erase(e[k]);
    &#125;
    bool isEmpty() &#123; &#x2F;&#x2F; 判断链表是否为空
        return l[tail] &#x3D;&#x3D; head;
    &#125;
    void print() &#123; &#x2F;&#x2F; 打印双链表
        for (int i &#x3D; r[head]; i !&#x3D; tail; i &#x3D; r[i])
            cout &lt;&lt; e[i] &lt;&lt; &quot; \n&quot;[i &#x3D;&#x3D; tail];
    &#125;
    bool checkInQueue(string s) &#123;
        return mp.count(s);
    &#125;
    bool checkInQueueButNotplay(string s) &#123;
        return mp.count(s) &amp;&amp; arr[0] !&#x3D; s &amp;&amp; arr[1] !&#x3D; s;
    &#125;

    void solve() &#123;
        init();

        int n;
        cin &gt;&gt; n;

        arr[0] &#x3D; arr[1] &#x3D; &quot;&quot;;
        for (int i &#x3D; 1; i &lt;&#x3D; n; i++)
        &#123;
            string op, name;
            cin &gt;&gt; op;

            if (op[0] &#x3D;&#x3D; &#39;s&#39;)
            &#123;
                if (arr[0] &#x3D;&#x3D; &quot;&quot;)&#x2F;&#x2F; 是第一局
                &#123;
                    &#x2F;&#x2F; 判断当前是否有人上场
                    if (!(r[head] &#x3D;&#x3D; tail)) &#x2F;&#x2F; 有人上场
                    &#123;
                        &#x2F;&#x2F; 输出人名
                        arr[0] &#x3D; e[r[head]];
                        int nxt &#x3D; r[r[head]];
                        if (nxt !&#x3D; tail)
                        &#123;
                            arr[1] &#x3D; e[nxt];
                            cout &lt;&lt; arr[0] &lt;&lt; &quot; &quot; &lt;&lt; arr[1] &lt;&lt;  &quot;\n&quot;;
                        &#125;
                        else
                        &#123;
                            cout &lt;&lt; arr[0] &lt;&lt; &quot;\n&quot;;
                        &#125;
                    &#125;
                    else &#x2F;&#x2F; 无人上场
                    &#123;
                        cout &lt;&lt; &quot;Error\n&quot;;
                    &#125;
                &#125;
                else
                &#123;
                    &#x2F;&#x2F; 将当前玩家放入队列中
                    if (arr[1] &#x3D;&#x3D; &quot;&quot;) &#x2F;&#x2F; 将前1个玩家放入队尾
                    &#123;
                        &#x2F;&#x2F; 并删除队列中前1元素
                        add(l[tail], arr[0]); 
                        del(r[head], true);
                    &#125;
                    else &#x2F;&#x2F; 将前2个玩家放入队尾
                    &#123;
                        &#x2F;&#x2F; 并删除队列中前2元素
                        add(l[tail], arr[0]);
                        add(l[tail], arr[1]);
                        del(r[head], true);
                        del(r[head], true);
                    &#125;


                    &#x2F;&#x2F; 从队列中取出前 1 &#x2F; 2名选手
                    &#x2F;&#x2F; 输出人名
                    arr[0] &#x3D; e[r[head]];
                    int nxt &#x3D; r[r[head]];
                    if (nxt !&#x3D; tail)
                    &#123;
                        arr[1] &#x3D; e[nxt];
                        cout &lt;&lt; arr[0] &lt;&lt; &quot; &quot; &lt;&lt; arr[1] &lt;&lt;  &quot;\n&quot;;
                    &#125;
                    else
                    &#123;
                        cout &lt;&lt; arr[0] &lt;&lt; &quot;\n&quot;;
                    &#125;
                &#125;
            &#125;
            else if (op[0] &#x3D;&#x3D; &#39;a&#39;)
            &#123;
                cin &gt;&gt; name;
                &#x2F;&#x2F; cout &lt;&lt; &quot;arrive:&quot; &lt;&lt; name &lt;&lt; &quot; &quot; &lt;&lt; mp.count(name) &lt;&lt; &quot; &quot; &lt;&lt; checkInQueue(name) &lt;&lt; &quot;\n&quot;;
                if (checkInQueue(name)) &#x2F;&#x2F; 如果这个人在排队, 输出
                &#123;
                    cout &lt;&lt; &quot;Error\n&quot;;
                &#125;
                else &#x2F;&#x2F; 加入队尾
                &#123;
                    add(l[tail], name);
                    cout &lt;&lt; &quot;OK\n&quot;;
                &#125;
            &#125;
            else
            &#123;
                cin &gt;&gt; name;
                if (checkInQueueButNotplay(name)) &#x2F;&#x2F; 如果在排队并且不在游完
                &#123;
                    cout &lt;&lt; &quot;OK\n&quot;;
                    int this_pos &#x3D; mp[name];
                    del(this_pos, false);
                &#125;
                else
                &#123;
                    cout &lt;&lt; &quot;Error\n&quot;;
                &#125;
            &#125;
        &#125;
    &#125;
    
&#125;lis;

int main()
&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);

    lis.solve();

    return 0;
&#125;</code></pre>

<h3 id="并查集-1"><a href="#并查集-1" class="headerlink" title="并查集"></a>并查集</h3><p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">template&lt;typename T&gt;
struct DSU &#123;
    vector&lt;T&gt; p, sz;
    DSU(T n) : p(n), sz(n, 1) &#123; iota(p.begin(), p.end(), 0); &#125;
    void init(int n) &#123;&#x2F;&#x2F;初始化
    p.resize(n);
    iota(p.begin(), p.end(), 0);
    sz.assign(n, 1);
    &#125;
    T find(T x) &#123; &#x2F;&#x2F;找父节点
       while (x !&#x3D; p[x]) x &#x3D; p[x] &#x3D; p[p[x]];
       return x;
    &#125;
    bool merge(T x, T y) &#123; &#x2F;&#x2F;合并集合
       x &#x3D; find(x);
       y &#x3D; find(y);
       if (x &#x3D;&#x3D; y) return false;
       sz[x] +&#x3D; sz[y];
       p[y] &#x3D; x;
       return true;
    &#125;
    bool same(T x, T y) &#123; return find(x) &#x3D;&#x3D; find(y); &#125;&#x2F;&#x2F;判断是否在同一集合
    T size(T x) &#123; return sz[find(x)]; &#125;&#x2F;&#x2F;获取集合大小
&#125;;</code></pre>

<p><mark>一般形式：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">void init(int n)
&#123;
    for(int i &#x3D; 1;i &lt;&#x3D; n;i++)	p[i] &#x3D; i;
&#125;

int find(int x)
&#123;
	return x &#x3D;&#x3D; p[x] ? p[x] &#x3D; find(p[x]);
&#125;</code></pre>

<p><mark>维护 $size$ 的并查集：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">bool merge(T x, T y) &#123; &#x2F;&#x2F;合并集合
    x &#x3D; find(x);
    y &#x3D; find(y);
    if (x &#x3D;&#x3D; y) return false;
    sz[x] +&#x3D; sz[y]; &#x2F;&#x2F; 关键代码
    p[y] &#x3D; x; &#x2F;&#x2F; 关键代码
&#125;</code></pre>



<h3 id="哈希"><a href="#哈希" class="headerlink" title="哈希"></a>哈希</h3><p><mark>封装模板（一维双哈希）：</mark></p>
<blockquote>
<p><strong>注意：</strong></p>
<p>当开多个 $Hash$ 结构体时，应注意空间问题，可将 $pw$ 数组开成全局变量，只初始化一次即可。</p>
</blockquote>
<pre class="language-c++" data-language="c++"><code class="language-c++">struct Hash
&#123;
    int base,mod;
    vector&lt;ll&gt; h,fh,pw;
    Hash(int _base,int _mod):base(_base),mod(_mod)&#123;&#125;

    void init()&#123;&#x2F;&#x2F;初始化
        h.resize(n + 1),fh.resize(n + 2),pw.resize(n + 1);
        pw[0] &#x3D; 1;
        for(int i &#x3D; 1;i &lt;&#x3D; n;i++)   pw[i] &#x3D; pw[i - 1] * base % mod;
        for(int i &#x3D; 1;i &lt;&#x3D; n;i++)   h[i] &#x3D; (h[i - 1] * base % mod + s[i]) % mod;
        for(int i &#x3D; n;i &gt;&#x3D; 1;i--)   fh[i] &#x3D; (fh[i + 1] * base % mod + s[i]) % mod;
    &#125;
    ll getz(int l,int r)&#123;&#x2F;&#x2F;获取区间正哈希值
        return (h[r] - h[l - 1] * pw[r - l + 1] % mod + mod) % mod;
    &#125;
    ll getf(int l,int r)&#123;&#x2F;&#x2F;获取区间反哈希值
        return (fh[l] - fh[r + 1] * pw[r - l + 1] % mod + mod) % mod;
    &#125;
    bool equ(int l,int r)&#123;&#x2F;&#x2F;比较该区间正反哈希值是否一致
        return getz(l,r) &#x3D;&#x3D; getf(l,r);
    &#125;
    bool equ(int l1,int r1,int l2,int r2)&#123;&#x2F;&#x2F;比较两区间正哈希值是否一致
        return getz(l1,r1) &#x3D;&#x3D; getz(l2,r2);
    &#125;
&#125;h1(131,998&#39;244&#39;353),h2(13331,1e9 + 7);</code></pre>

<p><mark>封装模板（二维哈希）：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">struct Hash
&#123;
    int base_x,base_y;
    vector&lt;vector&lt;ll&gt;&gt; h,fh;
    vector&lt;ll&gt; px,py;
    Hash(int _base_x, int _base_y): base_x(_base_x), base_y(_base_y) &#123;&#125;

    void init() &#123;&#x2F;&#x2F;初始化
        h.resize(n + 2), fh.resize(n + 2), px.resize(n + 1), py.resize(m + 1);
        for(int i &#x3D; 0;i &lt;&#x3D; n + 1;i++)   h[i].resize(m + 2),fh[i].resize(m + 2);
        px[0] &#x3D; 1;
        for (int i &#x3D; 1; i &lt;&#x3D; n; i++) px[i] &#x3D; px[i - 1] * base_x;
        py[0] &#x3D; 1;
        for (int i &#x3D; 1; i &lt;&#x3D; m; i++) py[i] &#x3D; py[i - 1] * base_y;
        for(int i &#x3D; 1;i &lt;&#x3D; n;i++)
            for(int j &#x3D; 1;j &lt;&#x3D; m;j++)
                h[i][j] &#x3D; h[i - 1][j] * base_x + h[i][j - 1] * base_y - h[i - 1][j - 1] * base_x * base_y + s[i][j];
        for(int i &#x3D; n;i &gt;&#x3D; 1;i--)
            for(int j &#x3D; m;j &gt;&#x3D; 1;j--)
                fh[i][j] &#x3D; fh[i + 1][j] * base_x + fh[i][j + 1] * base_y - fh[i + 1][j + 1] * base_x * base_y + s[i][j];
    &#125;   
    ll getz(int x1, int y1, int x2, int y2) &#123;&#x2F;&#x2F;获取矩阵区间: [x1,y1] -&gt; [x2,y2] 的正哈希值
        ll X &#x3D; px[x2 - x1 + 1], Y &#x3D; py[y2 - y1 + 1];
        return h[x2][y2] - h[x2][y1 - 1] * Y - h[x1 - 1][y2] * X + h[x1 - 1][y1 - 1] * X * Y;
    &#125;;
    ll getf(int x1, int y1, int x2, int y2) &#123;&#x2F;&#x2F;获取矩阵区间: [x1,y1] -&gt; [x2,y2] 的反哈希值
        ll X &#x3D; px[x2 - x1 + 1],Y &#x3D; py[y2 - y1 + 1];
        return fh[x1][y1] - fh[x1][y2 + 1] * Y - fh[x2 + 1][y1] * X + fh[x2 + 1][y2 + 1] * X * Y;
    &#125;
    bool equ(int l1, int r1, int l2, int r2) &#123;&#x2F;&#x2F;判断矩阵区间: [l1,r1] -&gt; [l2,r2] 的正反哈希值是否一致
        return getz(l1, r1, l2, r2) &#x3D;&#x3D; getf(l1, r1, l2, r2);
    &#125;
&#125;h1(131,149),h2(13&#39;331,1e9 + 7);</code></pre>

<p><strong>推荐题目（$2023\ CCPC$ 深圳铜牌题（二分 + 哈希））：</strong> <a target="_blank" rel="noopener" href="https://vjudge.net/contest/594105#problem/G">G - 相似基因序列问题</a></p>
<h3 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a>Trie</h3><p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">const int N &#x3D; 1e5 + 10, bit &#x3D; 31, M &#x3D; bit * N;
struct Trie
&#123;
    int idx, son[M][2];
    void clear () &#123; &#x2F;&#x2F; 清空
        for (int i &#x3D; 0; i &lt;&#x3D; idx; i++)
            son[i][0] &#x3D; son[i][1] &#x3D; 0;
        idx &#x3D; 0;
    &#125;
    void insert(int x) &#123;
        int p &#x3D; 0;
        for(int i &#x3D; bit;i &gt;&#x3D; 0;i--) &#123;
            int u &#x3D; x &gt;&gt; i &amp; 1;
            if(!son[p][u])  son[p][u] &#x3D; ++idx;
            p &#x3D; son[p][u];
        &#125;
    &#125;
    int query(int x) &#123;
        int p &#x3D; 0,res &#x3D; 0;
        for(int i &#x3D; bit;i &gt;&#x3D; 0;i--) &#123;
            int u &#x3D; x &gt;&gt; i &amp; 1;
            if(son[p][!u]) &#123;
                p &#x3D; son[p][!u];
                res &#x3D; res * 2 + !u;
            &#125;
            else &#123;
                p &#x3D; son[p][u];
                res &#x3D; res * 2 + u;
            &#125;
        &#125;
        return res;
    &#125;
&#125;trie;</code></pre>

<p><strong>推荐题目（tag：区间异或和最大值 + 一定量思维）：</strong><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1847/problem/C">C. Vampiric Powers, anyone?</a></p>
<p><mark>代码：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">const int N &#x3D; 1e5 + 10, bit &#x3D; 31, M &#x3D; bit * N;
struct Trie
&#123;
    int idx, son[M][2];
    void clear () &#123; &#x2F;&#x2F; 清空
        for (int i &#x3D; 0; i &lt;&#x3D; idx; i++)
            son[i][0] &#x3D; son[i][1] &#x3D; 0;
        idx &#x3D; 0;
    &#125;
    void insert(int x) &#123;
        int p &#x3D; 0;
        for(int i &#x3D; bit;i &gt;&#x3D; 0;i--) &#123;
            int u &#x3D; x &gt;&gt; i &amp; 1;
            if(!son[p][u])  son[p][u] &#x3D; ++idx;
            p &#x3D; son[p][u];
        &#125;
    &#125;
    int query(int x) &#123;
        int p &#x3D; 0,res &#x3D; 0;
        for(int i &#x3D; bit;i &gt;&#x3D; 0;i--) &#123;
            int u &#x3D; x &gt;&gt; i &amp; 1;
            if(son[p][!u]) &#123;
                p &#x3D; son[p][!u];
                res &#x3D; res * 2 + !u;
            &#125;
            else &#123;
                p &#x3D; son[p][u];
                res &#x3D; res * 2 + u;
            &#125;
        &#125;
        return res;
    &#125;
&#125;trie;</code></pre>

<h3 id="主席树（可持久化线段树）"><a href="#主席树（可持久化线段树）" class="headerlink" title="主席树（可持久化线段树）"></a>主席树（可持久化线段树）</h3><p>这里咱没有通用的模板，可以多刷几道这种类型的题目，感受下写法。</p>
<p><strong>推荐题目（湖北省赛金牌题）：</strong><a target="_blank" rel="noopener" href="https://codeforces.com/gym/105139/problem/F">F. Enchanted</a></p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;bits/stdc++.h></span></span>

using namespace std<span class="token punctuation">;</span>

using ll <span class="token operator">=</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">1e6</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">,</span> mod <span class="token operator">=</span> <span class="token number">1e9</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> A<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">;</span>
<span class="token keyword">int</span> a<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> idx<span class="token punctuation">;</span>
<span class="token keyword">int</span> root<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">Node</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">int</span> l<span class="token punctuation">,</span> r<span class="token punctuation">;</span>
	ll sum<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>tr<span class="token punctuation">[</span>N <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> N <span class="token operator">*</span> <span class="token number">17</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>


<span class="token keyword">int</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">int</span> p <span class="token operator">=</span> <span class="token operator">++</span>idx<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">==</span> r<span class="token punctuation">)</span>	
	<span class="token punctuation">&#123;</span>
		tr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>sum <span class="token operator">=</span> a<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> p<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">int</span> mid <span class="token operator">=</span> l <span class="token operator">+</span> r <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>
	tr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token function">build</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">,</span> tr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token function">build</span><span class="token punctuation">(</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
	tr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>sum <span class="token operator">=</span> tr<span class="token punctuation">[</span>tr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span>sum <span class="token operator">+</span> tr<span class="token punctuation">[</span>tr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>sum<span class="token punctuation">;</span>
	<span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> pos<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">int</span> q <span class="token operator">=</span> <span class="token operator">++</span>idx<span class="token punctuation">;</span>
	tr<span class="token punctuation">[</span>q<span class="token punctuation">]</span> <span class="token operator">=</span> tr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">==</span> r<span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		tr<span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">.</span>sum <span class="token operator">=</span> x<span class="token punctuation">;</span>
		<span class="token keyword">return</span> q<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">int</span> mid <span class="token operator">=</span> l <span class="token operator">+</span> r <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span>	tr<span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span>tr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>l<span class="token punctuation">,</span> l<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span>	tr<span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span>tr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>r<span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
	tr<span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">.</span>sum <span class="token operator">=</span> tr<span class="token punctuation">[</span>tr<span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">.</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span>sum <span class="token operator">+</span> tr<span class="token punctuation">[</span>tr<span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">.</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>sum<span class="token punctuation">;</span>
	<span class="token keyword">return</span> q<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

ll <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">int</span> q<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> ql<span class="token punctuation">,</span> <span class="token keyword">int</span> qr<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ql <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> qr <span class="token operator">>=</span> r<span class="token punctuation">)</span>	<span class="token keyword">return</span> tr<span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">.</span>sum<span class="token punctuation">;</span>
	<span class="token keyword">int</span> mid <span class="token operator">=</span> l <span class="token operator">+</span> r <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>
	ll res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ql <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span>	res <span class="token operator">+=</span> <span class="token function">query</span><span class="token punctuation">(</span>tr<span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">.</span>l<span class="token punctuation">,</span> l<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> ql<span class="token punctuation">,</span> qr<span class="token punctuation">)</span><span class="token punctuation">;</span>	 
	<span class="token keyword">if</span> <span class="token punctuation">(</span>qr <span class="token operator">></span> mid<span class="token punctuation">)</span>	res <span class="token operator">+=</span> <span class="token function">query</span><span class="token punctuation">(</span>tr<span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">.</span>r<span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> ql<span class="token punctuation">,</span> qr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	A <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">*</span> A <span class="token operator">+</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">19</span><span class="token char">'260'</span><span class="token number">817</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> A<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cin <span class="token operator">>></span> n <span class="token operator">>></span> m <span class="token operator">>></span> A <span class="token operator">>></span> p <span class="token operator">>></span> q<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	root<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> _ <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> _ <span class="token operator">&lt;=</span> m<span class="token punctuation">;</span> _<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		root<span class="token punctuation">[</span>_<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">[</span>_ <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> op <span class="token operator">=</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>op <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">int</span> L <span class="token operator">=</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> R <span class="token operator">=</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span>

			ll sum <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>root<span class="token punctuation">[</span>_<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">>></span> i <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">&#123;</span>
					res <span class="token operator">=</span> i<span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">&#125;</span>
			<span class="token function">assert</span><span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			cout <span class="token operator">&lt;&lt;</span> res <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>op <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">int</span> L <span class="token operator">=</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> R <span class="token operator">=</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

			ll sum <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>root<span class="token punctuation">[</span>_<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> right <span class="token operator">=</span> k<span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> k<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">&#123;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>sum <span class="token operator">>></span> i <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">&#123;</span>
					right <span class="token operator">=</span> i<span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span>
			<span class="token keyword">int</span> len <span class="token operator">=</span> right <span class="token operator">-</span> k<span class="token punctuation">;</span>
			ll ans <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1ll</span> <span class="token operator">&lt;&lt;</span> len<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1ll</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
			cout <span class="token operator">&lt;&lt;</span> ans <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>op <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">int</span> pos <span class="token operator">=</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
			root<span class="token punctuation">[</span>_<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span>root<span class="token punctuation">[</span>_<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> _<span class="token punctuation">;</span>
			root<span class="token punctuation">[</span>_<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h3><p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">const int N &#x3D; 1e5 + 10;
struct HLD
&#123;
    int a[N], cnt;
    int sz[N], top[N], dep[N], fa[N], son[N], id[N], nw[N];
    vector&lt;int&gt; g[N];
    struct Tree                          
    &#123;
        int l, r;
        ll add, sum;
    &#125;tr[N &lt;&lt; 2];

    void dfs1(int u, int father, int depth) &#123;
        dep[u] &#x3D; depth, fa[u] &#x3D; father, sz[u] &#x3D; 1;
        for (auto v : g[u])
        &#123;
            if (v &#x3D;&#x3D; father) continue;
            dfs1(v, u, depth + 1);
            sz[u] +&#x3D; sz[v];
            if (sz[son[u]] &lt; sz[v])  son[u] &#x3D; v;
        &#125;
    &#125;

    void dfs2(int u, int t)
    &#123;
        id[u] &#x3D; ++cnt, nw[cnt] &#x3D; a[u], top[u] &#x3D; t;
        if (!son[u]) return;
        dfs2(son[u], t);
        for (auto v : g[u])
        &#123;
            if (v &#x3D;&#x3D; fa[u] || v &#x3D;&#x3D; son[u])   continue;
            dfs2(v, v);
        &#125;
    &#125;
    
    int lca(int u, int v) &#123;
        while (top[u] !&#x3D; top[v]) 
        &#123;
            if (dep[top[u]] &gt; dep[top[v]])	u &#x3D; fa[top[u]];
            else	v &#x3D; fa[top[v]];
        &#125;
        return dep[u] &lt; dep[v] ? u : v;
    &#125;

    void pushup(int u)
    &#123;
        tr[u].sum &#x3D; tr[u &lt;&lt; 1].sum + tr[u &lt;&lt; 1 | 1].sum;
    &#125;

    void eval(Tree &amp;u,ll add)
    &#123;
        u.add +&#x3D; add;
        u.sum +&#x3D; (u.r - u.l + 1) * add;
    &#125;

    void pushdown(int u)
    &#123;
        eval(tr[u &lt;&lt; 1], tr[u].add);
        eval(tr[u &lt;&lt; 1 | 1], tr[u].add);
        tr[u].add &#x3D; 0;
    &#125;

    void build(int u,int l,int r)
    &#123;
        tr[u] &#x3D; &#123;l, r&#125;;
        if (l &#x3D;&#x3D; r)  return tr[u].sum &#x3D; nw[l], void();
        int mid &#x3D; l + r &gt;&gt; 1;
        build(u &lt;&lt; 1,l,mid), build(u &lt;&lt; 1 | 1,mid + 1,r);
        pushup(u);
    &#125;

    void update(int u, int l, int r, int k)
    &#123;
        if (l &lt;&#x3D; tr[u].l &amp;&amp; r &gt;&#x3D; tr[u].r)    
        &#123;   
            eval(tr[u], k);
        &#125;
        else
        &#123;
            pushdown(u);
            int mid &#x3D; tr[u].l + tr[u].r &gt;&gt; 1;
            if (l &lt;&#x3D; mid)    update(u &lt;&lt; 1, l, r, k);
            if (r &gt; mid) update(u &lt;&lt; 1 | 1, l, r, k);
            pushup(u);
        &#125;
    &#125;

    ll query(int u,int l,int r)
    &#123;
        if (l &lt;&#x3D; tr[u].l &amp;&amp; r &gt;&#x3D; tr[u].r)    return  tr[u].sum;
        pushdown(u);
        int mid &#x3D; tr[u].l + tr[u].r &gt;&gt; 1;
        ll res &#x3D; 0;
        if (l &lt;&#x3D; mid)    res +&#x3D; query(u &lt;&lt; 1, l, r);
        if (r &gt; mid) res +&#x3D; query(u &lt;&lt; 1 | 1, l, r);
        return res;
    &#125;

    void update_path(int u,int v,int k)
    &#123;
        while (top[u] !&#x3D; top[v])
        &#123;
            if (dep[top[u]] &lt; dep[top[v]]) swap(u, v);
            update(1, id[top[u]], id[u], k);
            u &#x3D; fa[top[u]];
        &#125;
        if (dep[u] &lt; dep[v]) swap(u, v);
        update(1, id[v], id[u], k);
    &#125;

    void update_tree(int u,int k)
    &#123;
        update(1, id[u], id[u] + sz[u] - 1, k);
    &#125;

    ll query_path(int u,int v)
    &#123;
        ll res &#x3D; 0;
        while (top[u] !&#x3D; top[v])
        &#123;
            if (dep[top[u]] &lt; dep[top[v]])   swap(u, v);
            res +&#x3D; query(1, id[top[u]], id[u]);
            u &#x3D; fa[top[u]];
        &#125;
        if (dep[u] &lt; dep[v]) swap(u,v);
        res +&#x3D; query(1, id[v], id[u]);
        return res;
    &#125;

    ll query_tree(int u)
    &#123;
        return query(1, id[u], id[u] + sz[u] - 1);
    &#125;
&#125;hld;</code></pre>



<h3 id="AC自动机"><a href="#AC自动机" class="headerlink" title="AC自动机"></a>AC自动机</h3><p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">const int N &#x3D; 1e6 + 10;
template&lt;typename T&gt;
struct AC_automation &#123;
    T cnt[N], len[N], ne[N];
    int tr[N][26], idx;

    AC_automation(): idx(0) &#123; &#125;
    void clear() &#123; &#x2F;&#x2F; 清空数组
        for (int i &#x3D; 0; i &lt;&#x3D; idx; i++) &#123;
            cnt[i] &#x3D; len[i] &#x3D; ne[i] &#x3D; 0;
            for (int j &#x3D; 0; j &lt; 26; j++) &#123;
                tr[i][j] &#x3D; 0;
            &#125;
        &#125;
        idx &#x3D; 0;
    &#125;
    void insert(string s) &#123;
        int p &#x3D; 0;
        for (int i &#x3D; 0; i &lt; s.size(); i++) &#123;
            int c &#x3D; s[i] - &#39;a&#39;;
            if (!tr[p][c])  tr[p][c] &#x3D; ++idx;
            p &#x3D; tr[p][c];
        &#125;
        cnt[p]++, len[p] &#x3D; s.size();
    &#125;
    void build() &#123;
        queue&lt;int&gt; q;
        for (int i &#x3D; 0; i &lt; 26; i++)
            if (tr[0][i])
                q.push(tr[0][i]);

        while (!q.empty()) &#123;
            auto t &#x3D; q.front();
            q.pop();

            for (int i &#x3D; 0; i &lt; 26; i++) &#123;
                int &amp;p &#x3D; tr[t][i];
                if (!p) p &#x3D; tr[ne[t]][i];
                else &#123;
                    ne[p] &#x3D; tr[ne[t]][i];
                    q.push(p);
                &#125;
            &#125;
        &#125;
    &#125;
    T query(string s) &#123;
        T res &#x3D; 0;
        for (int i &#x3D; 0, j &#x3D; 0; i &lt; s.size(); i++) &#123;
            int c &#x3D; s[i] - &#39;a&#39;;
            j &#x3D; tr[j][c];

            int p &#x3D; j;
            while (p &amp;&amp; ~cnt[p]) &#123;
                res +&#x3D; cnt[p];
                cnt[p] &#x3D; -1;
                p &#x3D; ne[p];
            &#125;
        &#125;
        return res;
    &#125;
&#125;;
AC_automation&lt;int&gt; AC;</code></pre>

<p> <strong>推荐题目：</strong><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3966">P3966 [TJOI2013] 单词</a></p>
<ul>
<li>记录每个前缀出现的次数；</li>
<li>队列的逆序为拓扑排序；</li>
<li>递推（dp）即可。</li>
</ul>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

const int N &#x3D; 1e6 + 10;
template&lt;typename T&gt;
struct AC_automation &#123;
    T ne[N], id[N], f[N], q[N];
    int tr[N][26], idx;

    AC_automation(): idx(0) &#123; &#125;
    void insert(string s, int index) &#123;
        int p &#x3D; 0;
        for (int i &#x3D; 0; i &lt; s.size(); i++) &#123;
            int c &#x3D; s[i] - &#39;a&#39;;
            if (!tr[p][c])  tr[p][c] &#x3D; ++idx;
            p &#x3D; tr[p][c];
            f[p]++;
        &#125;
        id[index] &#x3D; p;
    &#125;
    void build() &#123;
        int hh &#x3D; 0, tt &#x3D; -1;
        for (int i &#x3D; 0; i &lt; 26; i++)
            if (tr[0][i])
                q[++tt] &#x3D; tr[0][i];

        while (hh &lt;&#x3D; tt) &#123;
            auto t &#x3D; q[hh++];

            for (int i &#x3D; 0; i &lt; 26; i++) &#123;
                int &amp;p &#x3D; tr[t][i];
                if (!p) p &#x3D; tr[ne[t]][i];
                else &#123;
                    ne[p] &#x3D; tr[ne[t]][i];
                    q[++tt] &#x3D; p;
                &#125;
            &#125;
        &#125;
    &#125;
    void solve()
    &#123;
        int n;
        cin &gt;&gt; n;

        for (int i &#x3D; 1; i &lt;&#x3D; n; i++)
        &#123;
            string s;
            cin &gt;&gt; s;
            insert(s, i);
        &#125;

        build();

        for (int i &#x3D; idx - 1; i &gt;&#x3D; 0; i--)
            f[ne[q[i]]] +&#x3D; f[q[i]];
        
        for (int i &#x3D; 1; i &lt;&#x3D; n; i++)
            cout &lt;&lt; f[id[i]] &lt;&lt; &quot;\n&quot;;
    &#125;
&#125;;
AC_automation&lt;int&gt; AC;

int main()
&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);

    AC.solve();

    return 0;
&#125;</code></pre>



<h3 id="后缀自动机"><a href="#后缀自动机" class="headerlink" title="后缀自动机"></a>后缀自动机</h3><p><mark>封装模板：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">const int N &#x3D; 1e6 * 2 + 10; &#x2F;&#x2F; 空间开2倍
struct SAM
&#123;
    int tot,last;
    struct Node
    &#123;
        int len,fa;
        int ch[26];
        void init()&#123;&#x2F;&#x2F;结点初始化
            len &#x3D; fa &#x3D; 0;
            memset(ch,0,sizeof(ch));
        &#125;
    &#125;node[N];
    SAM() &#123;tot &#x3D; 1,last &#x3D; 1;&#125;
    void init() &#123;&#x2F;&#x2F;清空区间[1,tot]
        for(int i &#x3D; 1;i &lt;&#x3D; tot;i++) node[i].init();
        tot &#x3D; last &#x3D; 1;
    &#125;
    void extend(int c) &#123;&#x2F;&#x2F;添加一个字符(c - &#39;a&#39;)
        int p &#x3D; last,np &#x3D; last &#x3D; ++tot;
        node[np].len &#x3D; node[p].len + 1;
        for(;p &amp;&amp; !node[p].ch[c];p &#x3D; node[p].fa)    node[p].ch[c] &#x3D; np;
        if(!p)  node[np].fa &#x3D; 1;
        else
        &#123;
            int q &#x3D; node[p].ch[c];
            if(node[q].len &#x3D;&#x3D; node[p].len + 1)   node[np].fa &#x3D; q;
            else
            &#123;
                int nq &#x3D; ++ tot;
                node[nq] &#x3D; node[q],node[nq].len &#x3D; node[p].len + 1;
                node[q].fa &#x3D; node[np].fa &#x3D; nq;
                for(;p &amp;&amp; node[p].ch[c] &#x3D;&#x3D; q;p &#x3D; node[p].fa)    node[p].ch[c] &#x3D; nq;
            &#125;
        &#125;
    &#125;
&#125;sam;</code></pre>

<p> <strong>推荐题目：</strong><a target="_blank" rel="noopener" href="https://www.acwing.com/problem/content/2813/">最长公共子串</a></p>
<p><mark>代码：</mark></p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include&lt;bits&#x2F;stdc++.h&gt;

using namespace std;

const int N &#x3D; 1e4 * 2 + 10; &#x2F;&#x2F; 空间开2倍

struct SAM
&#123;
    int tot,last;
    struct Node
    &#123;
        int len,fa;
        int ch[26];
        void init()&#123;&#x2F;&#x2F;结点初始化
            len &#x3D; fa &#x3D; 0;
            memset(ch,0,sizeof(ch));
        &#125;
    &#125;node[N];
    SAM() &#123;tot &#x3D; 1,last &#x3D; 1;&#125;
    void init() &#123;&#x2F;&#x2F;清空区间[1,tot]
        for(int i &#x3D; 1;i &lt;&#x3D; tot;i++) node[i].init();
        tot &#x3D; last &#x3D; 1;
    &#125;
    void extend(int c) &#123;&#x2F;&#x2F;添加一个字符(c - &#39;a&#39;)
        int p &#x3D; last,np &#x3D; last &#x3D; ++tot;
        node[np].len &#x3D; node[p].len + 1;
        for(;p &amp;&amp; !node[p].ch[c];p &#x3D; node[p].fa)    node[p].ch[c] &#x3D; np;
        if(!p)  node[np].fa &#x3D; 1;
        else
        &#123;
            int q &#x3D; node[p].ch[c];
            if(node[q].len &#x3D;&#x3D; node[p].len + 1)   node[np].fa &#x3D; q;
            else
            &#123;
                int nq &#x3D; ++ tot;
                node[nq] &#x3D; node[q],node[nq].len &#x3D; node[p].len + 1;
                node[q].fa &#x3D; node[np].fa &#x3D; nq;
                for(;p &amp;&amp; node[p].ch[c] &#x3D;&#x3D; q;p &#x3D; node[p].fa)    node[p].ch[c] &#x3D; nq;
            &#125;
        &#125;
    &#125;
&#125;sam;

int main()
&#123;
    cin.tie(nullptr)-&gt;sync_with_stdio(false);

    int n;
    cin &gt;&gt; n;

    string s;
    cin &gt;&gt; s;

    for (auto c : s)    sam.extend(c - &#39;a&#39;);

    vector&lt;vector&lt;int&gt;&gt; g(N + 1);
    for (int i &#x3D; 2; i &lt;&#x3D; sam.tot; i++)  g[sam.node[i].fa].push_back(i);

    vector&lt;int&gt; res(N + 10, 1e9);
    for (int i &#x3D; 0; i &lt; n - 1; i++)
    &#123;
        cin &gt;&gt; s;
        vector&lt;int&gt; now(N + 10);
        function&lt;void(int)&gt; dfs &#x3D; [&amp;](int u) -&gt; void
        &#123;
            for (auto v : g[u]) 
            &#123;
                dfs(v);
                now[u] &#x3D; min(sam.node[u].len, max(now[u], now[v]));
            &#125;
        &#125;;
        int p &#x3D; 1, len &#x3D; 0;
        for (auto c : s)
        &#123;
            while (p &gt; 1 &amp;&amp; !sam.node[p].ch[c - &#39;a&#39;])   p &#x3D; sam.node[p].fa, len &#x3D; sam.node[p].len;
            if (sam.node[p].ch[c - &#39;a&#39;])    p &#x3D; sam.node[p].ch[c - &#39;a&#39;], len++;
            now[p] &#x3D; max(now[p], len);
        &#125;
        dfs(1);
        for (int i &#x3D; 1; i &lt;&#x3D; sam.tot; i++)  res[i] &#x3D; min(res[i], now[i]);
    &#125;

    cout &lt;&lt; *max_element(res.begin() + 1, res.begin() + sam.tot + 1) &lt;&lt; &quot;\n&quot;;
    return 0;
&#125;</code></pre>


                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">重生带我走</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://318471543.github.io/2024/10/08/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/">https://318471543.github.io/2024/10/08/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">重生带我走</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/">
                                    <span class="chip bg-color">算法模板</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/10/08/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="计算几何">
                        
                        <span class="card-title">计算几何</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-10-08
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            重生带我走
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/">
                        <span class="chip bg-color">计算几何</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/10/08/%E6%9D%82%E9%A2%98%E9%A2%98%E5%8D%95/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="杂题题单">
                        
                        <span class="card-title">杂题题单</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-10-08
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            重生带我走
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%9D%82%E9%A2%98%E9%A2%98%E5%8D%95/">
                        <span class="chip bg-color">杂题题单</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <a href="/about" target="_blank">重生带我走</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/318471543" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:318471543@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=318471543" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 318471543" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/5545924159" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/5545924159" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/shen-mu-yi-35" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/shen-mu-yi-35" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>

</html>
